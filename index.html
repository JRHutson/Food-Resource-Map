<html>
 
<head>
    <link rel="stylesheet" href="style.css" />
 
    <script src="http://code.jquery.com/jquery-latest.min.js "></script>
    <title>LA Food Bank Food Resources Map</title>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <script src="http://cdn.jsdelivr.net/leaflet.esri/1.0.0/esri-leaflet.js"></script>
    <script type="text/javascript">
    
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth();
        var yy = today.getYear();
 
        function daysInMonth(iMonth, iYear) {
            return 32 - new Date(iYear, iMonth, 32).getDate();
        }
 
        var days = daysInMonth(mm, yy)
 
        if ((days - dd) < 8) {
            last = 1
        } else {
            last = 0
        }
 
        if (dd < 8) {
            ww = '1'
        } else if (dd < 15) {
            ww = '2'
        } else if (dd < 22) {
            ww = '3'
        } else if (dd < 29) {
            ww = '4'
        } else {
            ww = '5'
        }
 
        week = ww;
 
        var day = today.getDay();
        current = "F" + week + day;
        
        var lastday = "L" + day;
 
        var tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        var td = tomorrow.getDate();
        var tm = tomorrow.getMonth();
        var ty = tomorrow.getYear();
        
        var tdays = daysInMonth(tm, ty)
 
        if ((tdays - td) < 8) {
            tlast = 1
        } else {
            tlast = 0
        }
        
        if (td < 8) {
            tw = '1'
        } else if (td < 15) {
            tw = '2'
        } else if (td < 22) {
            tw = '3'
        } else if (td < 29) {
            tw = '4'
        } else {
            tw = '5'
        }
 
        tomorrowweek = tw;
 
        var nextday = tomorrow.getDay();
        next = "F" + tomorrowweek + nextday;
        
        nextlast = "L" + nextday;
 
       
        var map;
 
        $(document).ready(function () {
 
            map = L.map('map').setView([34, -118], 9);
 
            //Basemap and Labels
 
            L.esri.basemapLayer('Gray').addTo(map);
            L.esri.basemapLayer('GrayLabels').addTo(map);

 
            //Defining Point Icons
 
            var foodicon = L.icon({
                iconUrl: 'https://github.com/JRHutson/Food-Resource-Map/blob/master/img/SmallLogoColor.png?raw=true',
                iconSize: [24, 37],
                iconAnchor: [13.5, 17.5],
                popupAnchor: [0, -11],
            });
 
            var nofoodicon = L.icon({
                iconUrl: 'https://github.com/JRHutson/Food-Resource-Map/blob/master/img/SmallLogoBlackAndWhite.png?raw=true',
                iconSize: [24, 37],
                iconAnchor: [13.5, 13.5],
                popupAnchor: [0, -11],
            });
 

            //Food Banks
        
           
            var foodbanks = L.esri.featureLayer({
                url: 'http://services6.arcgis.com/khUjDuArRH761yYG/arcgis/rest/services/FoodPantriesMaster/FeatureServer/0',
            pointToLayer: function (geojson, latlng) { 
                
                
                if (geojson.properties[current] == "TRUE" || geojson.properties[next] == "TRUE"){
                    return L.marker(latlng, {
                        icon: foodicon});
                }
                else if (last == 1 && geojson.properties[lastday] == "TRUE"){
                    return L.marker(latlng, {
                            icon: foodicon
                        });
                }
                else if (tlast == 1 && geojson.properties[nextlast] == "TRUE"){
                    return L.marker(latlng, {
                            icon: foodicon
                        });
                }
                else {
                    return L.marker(latlng, {
                            icon: nofoodicon
                        });
                    
                }}}).addTo(map);
           
 
            //Popup Configuration
 
            foodbanks.bindPopup(function (feature) {
                return L.Util.template('<p>{AgencyName}<br>{AgencyAddr}<br>{AgencyCity}, {AgencyStat} {AgencyZip}<br>{AgencyPhon}                               <br>Distribution Schedule: <br>{Schedule}</p>', feature.properties);
            });
 
            //County Outline
 
            var county = L.esri.featureLayer({
                url: 'http://services6.arcgis.com/khUjDuArRH761yYG/arcgis/rest/services/CountyOutline/FeatureServer/0',
                simplifyFactor: 0.35,
                style: function (feature) {
                    return {
                        color: '#0000FF',
                        fill: null,
                        weight: 3,
                        opacity: 0.25
                    }
                }
            }).addTo(map);
 
 
 
            //ADD MARKER
            /*var marker = L.marker([0,0]);
                        marker.bindPopup('Hello World!');
                        marker.addTo(map);
*/
            //ADD LINE
            /*
            var polyline = L.polyline([
                [0,90],
                [90,0],
                [0,-90],
                [-90,0],
                [0,90]
                ]);
            polyline.addTo(map);
            */
 
            //ADD POLYGON
            /*
            var polygon = L.polygon([
                [45,45],
                [45,-45],
                [-45,-45],
                [-45,45]
                ]);
            polygon.addTo(map);
            */
 
            //ADD GEOJSON
            /*
                        var geoJson = L.geoJson(County,{
                                onEachFeature: function(feature,layer){
                                        layer.bindPopup(feature.properties.NAMELSAD);
                                }
                        });
                        geoJson.addTo(map);
                       
*/
        });
 
        //Comment added for GitHub app test
    </script>
 
</head>
 
<body>
    <div id="map"></div>
</body>
 
</html>